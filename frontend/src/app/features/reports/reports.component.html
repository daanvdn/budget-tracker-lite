<mat-card>
  <mat-card-header>
    <mat-card-title>Reports & Aggregations</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="filterForm" class="filter-form">
      <h3>Filters</h3>

      <mat-form-field class="form-field-full-width">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="start_date">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="form-field-full-width">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="end_date">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="form-field-full-width">
        <mat-label>Transaction Type</mat-label>
        <mat-select formControlName="transaction_type">
          <mat-option [value]="null">All</mat-option>
          <mat-option value="expense">Expense</mat-option>
          <mat-option value="income">Income</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="form-field-full-width">
        <mat-label>Category</mat-label>
        <mat-select formControlName="category_id">
          <mat-option [value]="null">All</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="form-field-full-width">
        <mat-label>Beneficiary</mat-label>
        <mat-select formControlName="beneficiary_id">
          <mat-option [value]="null">All</mat-option>
          <mat-option *ngFor="let beneficiary of beneficiaries" [value]="beneficiary.id">
            {{ beneficiary.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="quick-filters">
        <button mat-raised-button type="button" (click)="setLastMonth()">Last Month</button>
        <button mat-raised-button type="button" (click)="setLast2Months()">Last 2 Months</button>
        <button mat-raised-button type="button" (click)="clearFilters()">Clear Filters</button>
      </div>

      <button mat-raised-button color="primary" type="button" (click)="loadSummary()">
        Apply Filters
      </button>
    </form>

    <div class="summary-cards" *ngIf="summary">
      <mat-card class="summary-card income-card">
        <mat-card-header>
          <mat-card-title>Total Income</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-amount">{{ summary.total_income | currency }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card expense-card">
        <mat-card-header>
          <mat-card-title>Total Expenses</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-amount">{{ summary.total_expenses | currency }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card balance-card">
        <mat-card-header>
          <mat-card-title>Net Balance</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-amount" [class.positive]="summary.net_balance > 0" [class.negative]="summary.net_balance < 0">
            {{ summary.net_balance | currency }}
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-header>
          <mat-card-title>Transaction Count</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="summary-amount">{{ summary.transaction_count }}</div>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-card-content>
</mat-card>

