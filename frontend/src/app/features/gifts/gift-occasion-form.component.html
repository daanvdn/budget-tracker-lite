<div class="form-container">
    <h2>{{ isEditMode ? ('gifts.editOccasion' | translate) : ('gifts.newOccasionTitle' | translate) }}</h2>

    <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
    </div>

    <form (ngSubmit)="onSubmit()" [formGroup]="form">
        <div class="form-group">
            <label for="name">{{ 'gifts.occasionName' | translate }} *</label>
            <input
                    formControlName="name"
                    id="name"
                    [placeholder]="'gifts.occasionNamePlaceholder' | translate"
                    type="text"
            />
            <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="error">
                {{ 'auth.nameRequired' | translate }}
            </div>
        </div>

        <div class="form-group">
            <label for="occasion_type">{{ 'gifts.occasionType' | translate }} *</label>
            <select formControlName="occasion_type" id="occasion_type">
                <option *ngFor="let type of occasionTypes" [value]="type">
                    {{ formatOccasionType(type) }}
                </option>
            </select>
        </div>

        <div class="form-group">
            <label for="occasion_date">{{ 'gifts.occasionDate' | translate }}</label>
            <input
                    formControlName="occasion_date"
                    id="occasion_date"
                    type="date"
            />
        </div>

        <div class="form-group">
            <label for="person_id">{{ 'gifts.forPerson' | translate }}</label>
            <div class="beneficiary-select-wrapper">
                <select formControlName="person_id" id="person_id">
                    <option [ngValue]="null">{{ 'gifts.none' | translate }}</option>
                    <option *ngFor="let b of beneficiaries" [ngValue]="b.id">
                        {{ b.name }}
                    </option>
                </select>
                <button type="button" class="btn-add-new" (click)="toggleNewBeneficiaryInput()" [title]="showNewBeneficiaryInput ? ('common.cancel' | translate) : ('gifts.addNewPerson' | translate)">
                    {{ showNewBeneficiaryInput ? 'Ã—' : '+' }}
                </button>
            </div>
            <div class="new-beneficiary-input" *ngIf="showNewBeneficiaryInput">
                <input
                    type="text"
                    [(ngModel)]="newBeneficiaryName"
                    [ngModelOptions]="{standalone: true}"
                    [placeholder]="'gifts.enterPersonName' | translate"
                    (keyup.enter)="createNewBeneficiary()"
                />
                <button
                    type="button"
                    class="btn btn-primary btn-small"
                    (click)="createNewBeneficiary()"
                    [disabled]="!newBeneficiaryName.trim() || creatingBeneficiary"
                >
                    {{ creatingBeneficiary ? ('common.creating' | translate) : ('common.create' | translate) }}
                </button>
            </div>
        </div>

        <div class="form-group checkbox-group">
            <label class="checkbox-label">
                <input formControlName="is_pool_account" type="checkbox"/>
                <span>{{ 'gifts.poolAccountLabel' | translate }}</span>
            </label>
            <p class="help-text">
                {{ 'gifts.poolAccountHelp' | translate }}
            </p>
        </div>

        <div class="form-group">
            <label for="notes">{{ 'common.notes' | translate }}</label>
            <textarea
                    formControlName="notes"
                    id="notes"
                    [placeholder]="'transactions.notesPlaceholder' | translate"
                    rows="3"
            ></textarea>
        </div>

        <div class="form-actions">
            <button (click)="onCancel()" class="btn btn-secondary" type="button">
                {{ 'common.cancel' | translate }}
            </button>
            <button
                    [disabled]="form.invalid || loading"
                    class="btn btn-primary"
                    type="submit"
            >
                {{ loading ? ('common.saving' | translate) : (isEditMode ? ('common.update' | translate) : ('common.create' | translate)) }}
            </button>
        </div>
    </form>
</div>

